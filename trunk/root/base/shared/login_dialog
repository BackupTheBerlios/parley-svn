<!-- login dialog (YUI) -->
<script type="text/javascript">
YAHOO.namespace("parley.login");

function init() {
	// Define various event handlers for Dialog
	var handleSubmit = function() {
		this.submit();
	};
	var handleCancel = function() {
		this.cancel();
	};
	var handleSuccess = function(o) {
        //console.log('Success');
	};
	var handleFailure = function(o) {
		alert("Submission failed: " + o.status);
	};

	// Instantiate the Dialog
	YAHOO.parley.login.login_dialog = new YAHOO.widget.Dialog(
        'login_dialog', 
        {
            postmethod : 'form',
            fixedcenter : true,
            visible : false, 
            modal: true,
            constraintoviewport : true,
            buttons : [
                { text:'Submit', handler:handleSubmit, isDefault:true },
                { text:'Cancel', handler:handleCancel }
            ]
        }
    );
	
	// Validate the entries in the form to require that both first and last name are entered
	YAHOO.parley.login.login_dialog.validate = function() {
		var data = this.getData();
		if (data.username == "" || data.password == "") {
			alert("[%l('Please enter your username and password')%].");
			return false;
		} else {
			return true;
		}
	};

	// Wire up the success and failure handlers
	YAHOO.parley.login.login_dialog.callback = { success: handleSubmit,
												 failure: handleFailure };
	
	// Render the Dialog
	YAHOO.parley.login.login_dialog.render();

    // firefox caret/cursor fix
    // from: http://yuiblog.com/sandbox/yui/v230/examples/container/ffcursor.html
    if (YAHOO.env.ua.gecko) {
        console.log('caret fix ...');
        var dlg = YAHOO.parley.login.login_dialog;
        /* 
            * Other part of workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=167801 !!?
            * I have no explanation for why the new thread (setTimeout) is needed, but it is.
            */
        YAHOO.util.Dom.addClass(dlg.form, "caretfix");

        dlg.showEvent.subscribe(function() {
            YAHOO.util.Dom.setStyle(dlg.form, "display", "none");

            var fixDisplay = function() {
                YAHOO.util.Dom.setStyle(dlg.form, "display", "block");
                try {
                    dlg.firstFormElement.focus();
                } catch (e) {
                    // Not related to the workaround, I just try/catch focus calls
                    // to avoid testing for the various conditions in which they could
                    // fail.
                }
            }
            setTimeout(fixDisplay, 0);
        });
        console.log('caret fixed ... ?');
    }
}

YAHOO.util.Event.onDOMReady(init);
</script>

<div id="login_dialog">
<div class="hd">[%l('Please enter your information')%]</div>
<div class="bd">
    <form action="user/login" method="post" name="login_form" class="login_dialog_form">
        <fieldset>
            <label for="username"><b>[%l('Username')%]:</b></label>
            <input type="text" id="username" name="username" style="width: 16em;" class="input_text" />
            <br />
            <label for="password"><b>[%l('Password')%]:</b></label>
            <input type="password" id="password" name="password" style="width: 15em;" class="input_text" />

            <p align="right">
            <a href="user/password/forgotten">[%l('Forgotten Password')%]</a>
            |
            <a id="login_dialog_hider" href="javascript:;">[%l('Close')%]</a><br />
            </p>
        </fieldset>
    </form>
</div>
</div>
<!-- (end) login dialog (YUI) -->
